plugins {
    id 'application'
    id 'org.openjfx.javafxplugin' version '0.1.0'
}

group = 'com.simplemessenger'
version = '1.0'

repositories {
    mavenCentral()
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(25) // Works on JDK 25+
    }
}

javafx {
    version = "25"
    modules = ['javafx.controls', 'javafx.fxml']
}

dependencies {
    implementation "org.openjfx:javafx-controls:25"
    implementation "org.openjfx:javafx-fxml:25"
}

application {
    // Default entry point
    mainClass = 'com.simplemessenger.client.MainApp'
}

tasks.register('runServer', JavaExec) {
    group = "application"
    description = "Run the chat server"
    classpath = sourceSets.main.runtimeClasspath
    mainClass.set("com.simplemessenger.server.ServerMain")
    jvmArgs = [
        "--module-path", configurations.runtimeClasspath.asPath,
        "--add-modules", "javafx.controls,javafx.fxml"
    ]
}

tasks.register('runClient', JavaExec) {
    group = "application"
    description = "Run the chat client"
    classpath = sourceSets.main.runtimeClasspath
    mainClass.set("com.simplemessenger.client.MainApp")
    jvmArgs = [
        "--module-path", configurations.runtimeClasspath.asPath,
        "--add-modules", "javafx.controls,javafx.fxml"
    ]
}

tasks.named('run') {
    jvmArgs = [
        "--module-path", configurations.runtimeClasspath.asPath,
        "--add-modules", "javafx.controls,javafx.fxml"
    ]
}

// Fixed runnable JAR task for Gradle 9
tasks.register('fatJar', Jar) {
    group = "build"
    description = "Assembles a self-contained runnable JAR"
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    manifest {
        attributes 'Main-Class': 'com.simplemessenger.client.MainApp'
    }
    from {
        configurations.runtimeClasspath.get().collect { it.isDirectory() ? it : zipTree(it) }
    }
    from sourceSets.main.output
}
